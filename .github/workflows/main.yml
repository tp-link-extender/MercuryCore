name: Deploy

on:
  push:
    branches:
      - main
      
jobs:
  deploy:
    runs-on: ubuntu-latest
  
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Server
        uses: fifsky/ssh-action@master
        with:
          command: |
            cd /home/heliodex/mercuryv2
            git restore .
            gh repo sync
            npx prisma migrate deploy
            pnpm i
            pnpm run build
            pm2 start pm2.config.cjs
          host: ${{ secrets.HOST }}
          port: ${{ secrets.PORT }} 
          user: ${{ secrets.USER }}
          key: ${{ secrets.PRIVATE_KEY }}
